#!/usr/bin/env bash

#
# These things are run when an Openbox X Session is started.
# You may place a similar script in $HOME/.config/openbox/autostart
# to run user-specific things.
#

xsetroot -solid '#3366aa'

gkrellm &
[[ -x $(command -v artha) ]] && (artha &)
parcellite &

# ugly hack - open pavucontrol and send it to desktop 8
pqp volume
(sleep 5 && pqp volume 50%) &   # Set a sane volume. Looking at you, pulseaudio.
(sleep 10 && xdotool set_desktop_for_window $(xdotool search --classname ^Pavucontrol$ | tail -n 1) 8) &

# OS_NAME is defined in ~/.config/openbox/environment
case $OS_NAME in
    *BSD)
        # xmessage $OS_NAME is '*BSD' &
        (sleep 0.8 && tint2) &
        (sleep 1.8 && dsbmixer -i) &
        ;;
    Gentoo)
        # xmessage $OS_NAME is 'Gentoo' &
        (sleep 0.8 && fbpanel --profile default) &
        (sleep 1.8 && volumeicon) &
        (sleep 3.0 && conky -q -d) &
        ;;
    *)
        xmessage $OS_NAME is 'unknown' &
        ;;
esac

(sleep 1.9 && $HOME/.fehbg) &
(sleep 2.0 && hello-fortune) &

(sleep 2.0 && picom) &

# Keyboard shortcuts
xbindkeys

# start services UI
# I hate those pesky *.desktop files...
#
# network manager UI
service=$(command -v service || command -v rc-service)
if [[ -n $service ]]; then
    # Call wicd-client if wicd daemon is running
    $service wicd status &> /dev/null && (wicd-client -t &> /dev/null &)
    # Call connman-gtk if connman daemon is running
    $service connman status &> /dev/null && (connman-gtk &> /dev/null &)
fi
# polkit authentication UI
service=$(command -v /usr/local/lib/libexec/polkit-kde-authentication-agent-1 || command -v /usr/lib64/libexec/polkit-kde-authentication-agent-1)
$service &

# Super key opens Openbox menu
# https://github.com/alols/xcape
eval $(grep ^HYPERVISOR= ~/.pqprc)
[[ -z $HYPERVISOR ]] && xcape -e 'Super_L=Control_L|Menu'
