# -*-Shell-script-*-
#
# These things are run when an Openbox X Session is started.
# You may place a similar script in $HOME/.config/openbox/autostart
# to run user-specific things.
#


# Autostart sequence
#
#  0.0 - background color
#  0.0 - gkrellm
#  0.0 - artha
#  0.0 - parcellite
#  0.0 - pavucontrol - pqp volume
#  0.0 - mixer - dsbmixer or volumeicon
#  0.0 - network manager
#  0.0 - polkit
#  0.0 - xcape
#  1.0 - wallpaper - fehbg
#  2.0 - picom
#  3.0 - panel - tint2 or fbpanel
#  4.0 - conky
#  5.0 - set volume - pqp volume 50%
#  6.0 - fortune
#  7.0 - hide pavucontrol


xsetroot -solid '#3366aa'

gkrellm &
[ -x "$(command -v artha)" ] && (artha &)
parcellite &

# ugly hack - open pavucontrol and send it to desktop 8
pqp volume
(sleep 5 && pqp volume 50%) &   # Set a sane volume. Looking at you, pulseaudio.
(sleep 7 && xdotool set_desktop_for_window $(xdotool search --classname ^Pavucontrol$ | tail -n 1) 8) &

# OS_NAME is defined in ~/.config/openbox/environment
case $OS_NAME in
    *BSD)
        # xmessage $OS_NAME is '*BSD' &
        dsbmixer -i &
        ;;
    Gentoo)
        # xmessage $OS_NAME is 'Gentoo' &
        volumeicon &
        (sleep 4.0 && conky -q -d) &
        ;;
    *)
        xmessage $OS_NAME is 'unknown' &
        ;;
esac

(sleep 1.0 && $HOME/.fehbg) &
(sleep 6.0 && hello-fortune) &

(sleep 2.0 && picom) &

(sleep 3.0 && tint2) &

# Keyboard shortcuts
xbindkeys

# start services UI
# I hate those pesky *.desktop files...
#
# network manager UI
if [ -x "$(command -v networkmgr)" ]; then
    sudo networkmgr &
else
    service=$(command -v service || command -v rc-service)
    if [ -n "$service" ]; then
        # Call wicd-client if wicd daemon is running
        $service wicd status &> /dev/null && (wicd-client -t &> /dev/null &)
        # Call connman-gtk if connman daemon is running
        $service connman status &> /dev/null && (connman-gtk &> /dev/null &)
    fi
fi
# polkit authentication UI
service=$(command -v /usr/local/lib/libexec/polkit-kde-authentication-agent-1 || command -v /usr/lib64/libexec/polkit-kde-authentication-agent-1)
$service &

# Super key opens Openbox menu
# https://github.com/alols/xcape
eval $(grep ^HYPERVISOR= ~/.pqprc)
[ -z "$HYPERVISOR" ] && xcape -e 'Super_L=Control_L|Menu'
