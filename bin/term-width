#!/usr/bin/env bash

COLUMNS=$(tput cols)
LINES=$(tput lines)

case "$(xrandr --query | grep " connected" | grep -oP '\d+x\d+' | cut -d 'x' -f1 | cut -d $'\n' -f1)" in
    "1024")
        # echo "(1024)"
        widths=(30 36 42 48 54 60 66 72 79 85 91 97 103 109 115 121 127 133 139 146)
        ;;
    "1280")
        # echo "(1280)"
        widths=(30 37 45 53 60 68 75 83 91 98 106 114 121 129 136 144 152 159 167 175 182)
        ;;
    "1920")
        # echo "(1920)"
        widths=(34 45 56 68 79 91 102 114 125 136 148 159 171 182 194 205 216 228 239 251 262 274)
        ;;
    *)
        # echo "(3840)"
        widths=(28 36 43 50 58 65 72 79 87 94 101 108 116 123 130 138 145 152 159 167 174 181 188 196 203 210 218 225 232 239 247 254 261 268 276 283 290 298 305 312 319 327 334 341 348)
        ;;
esac

result=${COLUMNS}
case "$1" in
    "")
        echo -n "COLUMNS=${COLUMNS}  WIDTH="
        xwininfo -id "$(xdotool getactivewindow)" | awk '/Width/ { print $2 }'
        exit 0
        ;;
    "up")
        for i in ${widths[@]}; do
            if [[ ${i} -gt ${COLUMNS} ]]; then
                result=${i}
                break
            fi
        done
        ;;
    "down")
        for i in ${widths[@]}; do
            if [[ ${i} -lt ${COLUMNS} ]]; then
                result=${i}
            else
                break
            fi
        done
        ;;
    *[!0-9]*)
        echo "Invalid: not an integer number." >&2
        exit 1
        ;;
    *)
        # Not not an integer number
        result=${1}
        ;;
esac

printf "\e[8;${LINES};${result}t"
exit 0
