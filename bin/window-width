#!/usr/bin/env bash

width=$(xwininfo -id "$(xdotool getactivewindow)" | awk '/Width/ { print $2 }')
case "$(xrandr --query | grep " connected" | grep -oP '\d+x\d+' | cut -d 'x' -f1 | cut -d $'\n' -f1)" in
    "1024")
        # echo "(1024)"
        widths=(211 254 297 339 382 425 467 510 553 595 638 681 723 766 809 851 894 937 979 1022)
        ;;
    "1280")
        # echo "(1280)"
        widths=(211 265 318 371 425 478 531 585 638 691 745 798 851 905 958 1011 1065 1118 1171 1225 1278)
        ;;
    "1920")
        # echo "(1920)"
        widths=(238 318 398 478 558 638 718 798 878 958 1038 1118 1198 1278 1358 1438 1518 1598 1678 1758 1838 1918)
        ;;
    *)
        # echo "(3840)"
        widths=(318 398 478 558 638 718 798 878 958 1038 1118 1198 1278 1358 1438 1518 1598 1678 1758 1838 1918 1998 2078 2158 2238 2318 2398 2478 2558 2638 2718 2798 2878 2958 3038 3118 3198 3278 3358 3438 3518 3598 3678 3758 3838)
        ;;
esac

result=${width}
case "$1" in
    "")
        echo "WIDTH=${width}"
        exit 0
        ;;
    "show")
        echo "WIDTH=${width}" | iconv -f UTF-8 -t ISO-8859-1 | LANG=C xmessage -timeout 5 -buttons OK:0 -default OK -file - &
        exit 0
        ;;
    "up")
        width=$((width + 20))
        for i in ${widths[@]}; do
            if [[ ${i} -gt ${width} ]]; then
                result=${i}
                break
            fi
        done
        ;;
    "down")
        width=$((width - 20))
        for i in ${widths[@]}; do
            if [[ ${i} -lt ${width} ]]; then
                result=${i}
            else
                break
            fi
        done
        ;;
    *[!0-9]*)
        echo "Invalid: not an integer number." >&2
        exit 1
        ;;
    *)
        # Not not an integer number
        result=${1}
        ;;
esac

wmctrl -r :ACTIVE: -e "0,-1,-1,${result},-1" &
exit 0
